<% if session[:user] %>
  <form action="/create_room" method="post">
    <input type="submit" value="部屋の追加">
  </form>
<% else %>
  <p>閲覧モードです．対戦にはログインが必要です．</p>
<% end %>
<p>募集中</p>
<table>
<% @rooms.select{|game| game.status == 'waiting'}.each do |room| %>
  <tr>
    <td><a href="/room/<%= room.id %>">Room<%= room.id %>へ</a></td>
    <td><%= room.game_users.first.user.name %></td>
  </tr>
<% end %>
</table>

<% rooms = @rooms.select{|room| room.status == 'doing' }%>
<p>対戦中</p>
<table>
<% rooms.each do |room| %>
  <tr>
    <td><a href="/room/<%= room.id %>">Room<%= room.id %>へ</a></td>
    <td><%= room.game_users.first.user.name %></td>
    <td><%= room.game_users.second.user.name %></td>
  </tr>
<% end %>
</table>

<% if session[:user] # ログインしていたら %>
<% rooms = @rooms.select{|room| room.status == 'finished' and room.joinUser(session[:user])}%>
<p>対戦履歴</p>
<table>
<% rooms.each do |room| %>
  <tr>
    <td><a href="/room/<%= room.id %>">Room<%= room.id %>へ</a></td>
    <td class="<%= room.turn != 'white' ? "loser" : "\"\""%>"><%= room.game_users.first.user.name %></td>
    <% if room.game_users.second.user.id != 1 %>
      <td class="<%= room.turn != 'black' ? "loser" : "\"\""%>"><%= room.game_users.second.user.name %></td>
    <% else %>
      <td class="">接続切れのため負け</td>
    <% end %>
  </tr>
<% end %>
</table>
<% end %>

<style>
  .loser{
    background-color: red;
  }
</style>